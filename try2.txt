<div class="card-body">
    <h1 class="text-center font-weight-bold">@Model.Titre</h1>

    <!-- Statut -->
    <div class="d-flex justify-content-between align-items-center">
        <p class="w-50"><strong>Statut:</strong> 
            <span id="statutDisplay">@Model.Statut?.StatutNom</span>
            <button class="btn btn-sm btn-link text-black" id="editStatutBtn"><i class="fas fa-edit"></i></button>
        </p>
        <form id="statutForm" style="display: none;" method="post" asp-action="UpdateStatut">
            <input type="hidden" name="IncidentId" value="@Model.IncidentId" />
            <select name="StatutId" class="form-control d-inline-block w-75" asp-items="ViewBag.StatutId">
                <option value="">SÃ©lectionnez un statut</option>
            </select>
            <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-save"></i></button>
            <button type="button" class="btn btn-danger btn-sm" id="cancelStatutEdit"><i class="fas fa-ban"></i></button>
        </form>
    </div>

    <!-- Description -->
    <div class="d-flex justify-content-between align-items-center">
        <p class="w-50"><strong>Description:</strong> 
            <span id="descriptionDisplay">@Model.Description</span>
            <button class="btn btn-sm btn-link text-black" id="editDescriptionBtn"><i class="fas fa-edit"></i></button>
        </p>
        <form id="descriptionForm" style="display: none;" method="post" asp-action="UpdateDescription">
            <input type="hidden" name="IncidentId" value="@Model.IncidentId" />
            <textarea name="Description" class="form-control d-inline-block w-75">@Model.Description</textarea>
            <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-save"></i></button>
            <button type="button" class="btn btn-danger btn-sm" id="cancelDescriptionEdit"><i class="fas fa-ban"></i></button>
        </form>
    </div>

    <!-- Impact -->
    <div class="d-flex justify-content-between align-items-center">
        <p class="w-50"><strong>Impact:</strong> 
            <span id="impactDisplay">@Model.Impact</span>
            <button class="btn btn-sm btn-link text-black" id="editImpactBtn"><i class="fas fa-edit"></i></button>
        </p>
        <form id="impactForm" style="display: none;" method="post" asp-action="UpdateImpact">
            <input type="hidden" name="IncidentId" value="@Model.IncidentId" />
            <textarea name="Impact" class="form-control d-inline-block w-75">@Model.Impact</textarea>
            <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-save"></i></button>
            <button type="button" class="btn btn-danger btn-sm" id="cancelImpactEdit"><i class="fas fa-ban"></i></button>
        </form>
    </div>
</div>


<script>
    // Statut
    document.getElementById('editStatutBtn').addEventListener('click', function () {
        document.getElementById('statutDisplay').style.display = 'none';
        document.getElementById('editStatutBtn').style.display = 'none';
        document.getElementById('statutForm').style.display = 'block';
    });
    document.getElementById('cancelStatutEdit').addEventListener('click', function () {
        document.getElementById('statutDisplay').style.display = 'inline';
        document.getElementById('editStatutBtn').style.display = 'inline';
        document.getElementById('statutForm').style.display = 'none';
    });

    // Description
    document.getElementById('editDescriptionBtn').addEventListener('click', function () {
        document.getElementById('descriptionDisplay').style.display = 'none';
        document.getElementById('editDescriptionBtn').style.display = 'none';
        document.getElementById('descriptionForm').style.display = 'block';
    });
    document.getElementById('cancelDescriptionEdit').addEventListener('click', function () {
        document.getElementById('descriptionDisplay').style.display = 'inline';
        document.getElementById('editDescriptionBtn').style.display = 'inline';
        document.getElementById('descriptionForm').style.display = 'none';
    });

    // Impact
    document.getElementById('editImpactBtn').addEventListener('click', function () {
        document.getElementById('impactDisplay').style.display = 'none';
        document.getElementById('editImpactBtn').style.display = 'none';
        document.getElementById('impactForm').style.display = 'block';
    });
    document.getElementById('cancelImpactEdit').addEventListener('click', function () {
        document.getElementById('impactDisplay').style.display = 'inline';
        document.getElementById('editImpactBtn').style.display = 'inline';
        document.getElementById('impactForm').style.display = 'none';
    });
</script>


[HttpPost]
public IActionResult UpdateStatut(int IncidentId, int StatutId)
{
    var incident = _context.Incidents.Find(IncidentId);
    if (incident != null)
    {
        incident.StatutId = StatutId;
        _context.SaveChanges();
    }
    return RedirectToAction("Details", new { id = IncidentId });
}

[HttpPost]
public IActionResult UpdateDescription(int IncidentId, string Description)
{
    var incident = _context.Incidents.Find(IncidentId);
    if (incident != null)
    {
        incident.Description = Description;
        _context.SaveChanges();
    }
    return RedirectToAction("Details", new { id = IncidentId });
}

[HttpPost]
public IActionResult UpdateImpact(int IncidentId, string Impact)
{
    var incident = _context.Incidents.Find(IncidentId);
    if (incident != null)
    {
        incident.Impact = Impact;
        _context.SaveChanges();
    }
    return RedirectToAction("Details", new { id = IncidentId });
}

