[HttpPost]
public async Task<IActionResult> ToggleStatus(int id)
{
    Console.WriteLine($"ToggleStatus appelé pour Criticité ID: {id}"); // Log de test

    var criticite = await _context.Criticites.FindAsync(id);
    if (criticite == null)
    {
        return NotFound(new { success = false, message = "Criticité introuvable." });
    }

    criticite.Statut = criticite.Statut == "Actif" ? "Inactif" : "Actif";

    await _context.SaveChangesAsync();

    return Json(new
    {
        success = true,
        message = $"Vous venez de {(criticite.Statut == "Actif" ? "activer" : "désactiver")} la criticité {criticite.CriticiteNom}."
    });
}

<script>
   document.querySelectorAll('.toggle-status').forEach(toggle => {
    toggle.addEventListener('change', function () {
        const criticiteId = this.getAttribute('data-id');
        const isChecked = this.checked;

        console.log(`Envoi de la requête pour ID: ${criticiteId}, statut: ${isChecked}`);

        fetch('/Criticite/ToggleStatus', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]').value
            },
            body: JSON.stringify({ id: criticiteId })
        })
            .then(response => response.json())
            .then(data => {
                console.log(data); // Log pour voir la réponse
                if (data.success) {
                    alert(data.message);
                } else {
                    alert('Erreur: ' + data.message);
                    this.checked = !isChecked; // Revert the toggle on failure
                }
            })
            .catch(error => {
                console.error('Erreur dans la requête:', error);
                this.checked = !isChecked; // Revert the toggle on failure
            });
    });
});

</script>

<input name="__RequestVerificationToken" type="hidden" value="@Antiforgery.GetAndStoreTokens(HttpContext).RequestToken" />

var criticite = await _context.Criticites.FindAsync(1); // ID d'exemple
criticite.Statut = "Inactif";
await _context.SaveChangesAsync();



<td>
    <label class="switch">
        <input type="checkbox" 
               class="toggle-status" 
               data-id="@criticite.CriticiteId" 
               @(criticite.Statut == "Actif" ? "checked" : "")>
        <span class="slider round"></span>
    </label>
</td>



<td>
    <label class="switch">
        <input type="checkbox" 
               class="toggle-status" 
               data-id="@criticite.CriticiteId" 
               @(criticite.Statut == "Actif" ? "checked" : "")>
        <span class="slider round"></span>
    </label>
</td>


<style>
    .switch {
        position: relative;
        display: inline-block;
        width: 34px;
        height: 20px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #4CAF50;
    }

    input:checked + .slider:before {
        transform: translateX(14px);
    }
</style>
